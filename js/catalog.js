(()=>{"use strict";const t=function(t){const n=document.createElement("div");n.classList.add("modal-backdrop"),n.classList.add("fade"),document.body.append(n),t.classList.add("d-block"),setTimeout((function(){n.classList.add("show"),t.classList.add("show")}),100)},n=function(t){const n=document.querySelector(".modal-backdrop");n&&n.classList.remove("show"),t.classList.remove("show"),setTimeout((function(){t.classList.remove("d-block"),n&&n.remove()}),500),t.classList.remove("d-block")},e="http://localhost:3001",o=function(t){return fetch(e+t).then((function(t){if(!1===t.ok)throw new Error("Ошибка...");return t.json()}))},c=function(t,n){return fetch(e+t,{method:"PATCH",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((function(t){if(!1===t.ok)throw new Error("Ошибка...");return t.json()}))};!function(){const e=document.getElementById("open-auth-btn"),c=document.getElementById("auth-modal"),s=c.querySelectorAll(".close-btn"),a=document.querySelector(".login-btn"),i=document.getElementById("logout-btn"),r=document.getElementById("open-cart-btn"),d=(document.getElementById("cart-modal"),function(){e.classList.add("d-none"),i.classList.remove("d-none"),r.classList.remove("d-none"),n(c)});e.addEventListener("click",(function(){t(c)})),s.forEach((function(t){t.addEventListener("click",(function(){n(c)}))})),a.addEventListener("click",(function(){const t=c.querySelector("#login-control"),n=c.querySelector("#password-control"),e=t.value,s=n.value;o("/profile").then((function(t){t.login&&t.login===e&&t.password&&t.password===s?(localStorage.setItem("auth",JSON.stringify(t)),d()):alert("Ви ввели не верние данние")}))})),i.addEventListener("click",(function(){localStorage.removeItem("auth"),e.classList.remove("d-none"),i.classList.add("d-none"),r.classList.add("d-none")})),function(){const t=JSON.parse(localStorage.getItem("auth"));t&&o("/profile").then((function(n){n.login&&n.login===t.login&&n.password&&n.password===t.password?d():alert("Ви ввели не верние данние")}))}()}(),function(){const t=document.getElementById("products-container");t.addEventListener("click",(function(t){if(t.target.closest("button")){const n=t.target.closest("button").dataset.product;console.log("Ид товара: "+n),o(`/products/${n}`).then((function(t){var n;("/cart",n={name:t.name,price:t.price,count:1},fetch(e+"/cart",{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((function(t){if(!1===t.ok)throw new Error("Ошибка...");return t.json()}))).then((function(){}))})).catch((function(t){console.error("Произошла Ошибка")}))}})),function(){const n=window.location.search,e=new URLSearchParams(n),c=e.get("id"),s=c?`/products?category=${c}`:"/products";console.log(e.get("id")),o(s).then((function(n){!function(n){n.forEach((function(n){t.insertAdjacentHTML("beforeend",`\n            \n                <div class="col col-12 col-sm-6 col-lg-4 col-xl-3 mb-3">\n                    <a href="#" class="card-link">\n                        <div class="card">\n                            <img src="${n.preview}" class="card-img-top" alt="phone-1">\n                            <div class="card-body">\n                                <span class="mb-2 d-block text-secondary">${n.title}</span>\n                                <h6 class="card-title mb-3">${n.name}</h6>\n                                <div class="row">\n                                    <div class="col d-flex align-itemns-center justify-content-between">\n                                        <h4>${n.price} ₽</h4>\n                                        <button type="button" class="btn btn-outline-dark" data-product = "${n.id}" >\n                                            <img src="/images/icon/shopping-cart-big.svg" alt="login">\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </a>\n                </div>\n\n            \n            \n            `)}))}(n)})).catch((function(t){}))}()}(),function(){const e=document.getElementById("cart-container"),s=document.getElementById("cart-modal"),a=document.getElementById("open-cart-btn"),i=s.querySelectorAll(".close-btn"),r=document.getElementById("cart-totlal-price"),d=function(){o("/cart").then((function(t){!function(t){e.innerHTML="",t.forEach((function(t){e.insertAdjacentHTML("beforeend",`\n                        <div class="row border-bottom pb-3 pt-3">\n                            <div class="col col-12 col-md-6 mb-3 mb-md-0 fs-4">\n                                ${t.name}\n                            </div>\n                            <div class="col col-12 col-md-6 fs-4 d-flex align-items-center justify-content-end flex-wrap">\n                                <h4 class="me-3 d-flex align-itemns-center">${t.price} ₽</h4>\n                                <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls"\n                                    id="control-dec" data-id="${t.id}" data-count="${t.count}">\n                                    -\n                                </button>\n                                <h6 class="cart-item-count me-3 ms-3">${t.count}</h6>\n                                <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls"\n                                    id="control-inc" data-id="${t.id}" data-count="${t.count}">\n                                    +\n                                </button>\n                            </div>\n                        </div>\n            \n            `)}))}(t),l(t)})).catch((function(t){}))},l=function(t){let n=0;t.forEach((function(t){n=(n+Number(t.price))*Number(t.count)})),r.textContent=n+" ₽"};a.addEventListener("click",(function(){d(),t(s)})),i.forEach((function(t){t.addEventListener("click",(function(){n(s)}))})),e.addEventListener("click",(function(t){if(t.target.closest("button"))if(t.target.id&&"control-inc"===t.target.id){const n=t.target.dataset.id,e=Number(t.target.dataset.count);c(`/cart/${n}`,{count:e+1}).then((function(){d()}))}else if(t.target.id&&"control-dec"===t.target.id){const n=t.target.dataset.id,e=Number(t.target.dataset.count);e>0&&c(`/cart/${n}`,{count:e-1}).then((function(){d()}))}}))}()})();